%!TEX root = main.tex

\section{Introduction}

The Bitcoin Protocol \cite{Bitcoin,DBLP:books/daglib/0040621,NC17}, or Nakamoto Protocol, introduces a novel decentralized network-consensus mechanism that is trustless and open for anyone connected to the Internet. %Moreover, it allows participants to leave and re-join the network at will. 
To support such an open and dynamic topology, the protocol requires an underlying currency (a so-called \emph{cryptocurrency} \cite{NC17}) to encourage/discourage participants to/from taking certain actions. The largest network running this protocol at the time of writing is the Bitcoin network, and its underlying cryptocurrency is Bitcoin (BTC). %As of September 2018, Bitcoin is the most successful cryptocurrency with a value per unit of about 6,500 USD\footnote{\url{https://blockchain.info/charts/market-price}.}
%\cite{BitcoinPrice} 
% and more than 17 million units in circulation.\footnote{\url{https://blockchain.info/charts/total-bitcoins}.}
%~\cite{Totalcoins}.
%  \etienne{Modify number just before submitting!}
The popularity of the protocol goes beyond Bitcoin. Some of them are simple replicas of Bitcoin with slight modifications on the protocol parameters (e.g. Litecoin~\cite{Litecoin} or Bitcoin Cash~\cite{Bcash}), while some of them introduce interesting new modifications on top of the protocol to provide further functionalities (e.g. Ethereum~\cite{Ethereum,E17} or Monero~\cite{Monero}). 
 
%Following the success of Bitcoin, several new cryptocurrencies have been created. Some of them are simple replicas of Bitcoin with slight modifications on the protocol parameters (e.g. Litecoin~\cite{Litecoin} or Bitcoin Cash~\cite{Bcash}), while some of them introduce interesting new modifications on top of the protocol to provide further functionalities (e.g. Ethereum~\cite{Ethereum,E17} or Monero~\cite{Monero}). To this day more than 1,500 cryptocurrencies are being traded~\cite{coinmarketcap}, most of which follow variations of the same underlying protocol.
%~\cite{coinmarketcap}.
% \etienne{Modify number just before submitting!}

However, and despite the success and popularity of cryptocurrencies, the foundational aspects of their ruling protocols are far from being fully understood. As it has been claimed before \cite{mininggames:2016}, the Bitcoin protocol involves many actors and incentives, making it rather hard to formalize and study rigorously. Our 
goal is to construct a model that will serve both for a clean understanding its actors and incentives, and for studying the implications and consequences of future modifications to the 
Nakamoto protocol. A good body of research pursuing this objective has been presented recently~\cite{mininggames:2016,optimalselfishmining2017,instabilitywithoutreward:2016,selfishmining2014,stop_selfish_mining2014,eclipseattacks2015,LBSZR15,LJG15,stubborn_mining:2016,economics_of_mining2013,ZGR17,ABLZ17,MHG18,SZWTK18}, yet some concession and simplification regarding the model had to be made. 

In this paper we focus on the action of \emph{mining}. We model mining as an infinite stochastic game, and we study what are the best mining strategies based on 
different choices for mining rewards. In contrast to other previous work, our model is general enough to consider any possible mining strategy, and 
we study crypto-mining assuming a closed world with no option to ``cash out" and leave the market, as we believe that this scenario gives us the cleanest possible model.  
%A good body of research pursuing this objective has been presented recently~\cite{mininggames:2016,optimalselfishmining2017,instabilitywithoutreward:2016,selfishmining2014,stop_selfish_mining2014,eclipseattacks2015,LBSZR15,LJG15,stubborn_mining:2016,economics_of_mining2013,ZGR17,ABLZ17,MHG18,SZWTK18}, yet some concession and simplification regarding the model had to be made. In this paper, we present a formal model that takes some of these concessions into consideration. 
Before presenting our contributions and discussing the related work, we give a brief introduction to Bitcoin protocol. %open blockchain protocol based on proof of work, emphasising his prime implementation Bitcoin. 

\smallskip
\noindent
{\bf The Bitcoin protocol.} The objective of the Bitcoin protocol is to generate consensus on a data structure that is replicated amongst all nodes in a trustless 
and decentralized peer-to-peer network. The data structure used in the protocol is an append-only record of transactions, and the inclusion of new transactions work as follows. 
Every node that with to include a new transaction can do so, and these are spread across the network in a peer-to-peer fashion. However, this does not give guarantees 
regarding who received which transactions, so at this point they are not considered valid. Eventually, one node will be \emph{allowed} (we will explain this in detail later) to assemble a group of transactions into a new \emph{block}, which is presented as a candidate to extend the data structure. Apart from the set of transactions, the block will contain a pointer to some previous block. The newly formed block is then spread throughout the network, also following a whispering protocol. Since every block points to a previous block, a tree of blocks is naturally formed. The consensus data structure is generally defined as the longest branch of such a tree, which is commonly known as the \emph{blockchain}.

%The objective of the Bitcoin protocol is to generate consensus on a data structure that is replicated amongst all nodes in a trustless 
%and decentralized peer-to-peer network, in such a way that everyone %(not only participants of the network)
%can verify the integrity of the complete data structure without trusting others. Moreover, the network is open for anyone to participate, and participants can leave and re-join the network at will. To achieve consensus under these conditions, the protocol requires the shared data structure to be an append-only record of transactions. The inclusion of new transactions to this data structure works as follows: every node that wants to include new transactions must communicate these transactions to their neighbours, who will in turn communicate them with their neighbors, and so on. Transactions are then spread throughout the network via so-called \emph{peer-to-peer whispering}. Naturally, there is no guarantee regarding who received which transaction, so at this point these transactions cannot be considered valid yet. Eventually, one node will be \emph{allowed} (we will explain this in detail later) to assemble a group of transactions into a new \emph{block}, which is presented as a candidate to extend the data structure. Apart from the set of transactions, the block will contain a pointer to some previous block. The newly formed block is then spread throughout the network, also following a whispering protocol. Since every block points to a previous block, a tree of blocks is naturally formed. The consensus data structure is generally defined as the longest branch of such a tree, which is commonly known as the \emph{blockchain}.

To make the dynamics described above, the protocol requires an underlying currency to encourage actors in the network to take certain actions. The most important action is 
the generation of new blocks: whenever a participant forms a new block, she receives a certain amount of currency. This is known as the block reward, and is the way in which new coins are created. In Bitcoin, this amount was originally 50BTC and halves approximately every four years, which is informally known as Bitcoin's \emph{deflation}; the reward is currently 12.5BTC. The currency generated in a block is considered valid only if the block belongs to the blockchain. This is important, because blocks rewards may cease to be 
valid currency if a block is no longer part of the blockchain, even if the block was part of it when it was created. 
%To make the dynamics described above work in a trustless and decentralized network with adversaries, the protocol requires an underlying currency to encourage actors in the network to take certain actions. The first and most important incentive is for the generation of new blocks. Whenever a participant forms a new block, he is rewarded by the protocol with a certain amount of currency. This is known as the block reward, and is the way in which new coins are created. In Bitcoin, this amount was originally 50BTC and halves approximately every four years, which is informally known as Bitcoin's \emph{deflation}; the reward is currently 12.5BTC. The currency generated in a block is considered valid only if the block belongs to the blockchain.% Some additional rules can be added, for instance in Bitcoin the money rewarded by a new block can only be spent whenever the block has at least 100 descendants in the blockchain.
Therefore, whenever a node forms a new block, it is encouraged to place this block in a part of the tree with a high probability of becoming part of the blockchain. Actually, the protocol states that new blocks should always be appended on top of a block with maximal distance to the root of the tree, although participants are not obliged to follow this rule.

Since blocks give a reward, nodes will naturally want to generate blocks. If we expect the currency to have any value, generating new blocks must then be hard. Under the proof-of-work framework, participants generating new blocks are required to solve some computationally hard problem per each new block. In Bitcoin, a block is \emph{valid} in the protocol if its hash value, when interpreted as a number, is less than a certain threshold. Since hash functions are pseudo-random, the only way to generate a valid block is to try with several different blocks, until one of them has a hash value below the established threshold. This is known as \emph{mining}, and the number of (valid and invalid) blocks per second that a miner can hash is referred to as his \emph{hash power}. Nodes who participate in the generation of blocks %(which are in practice very few, compared to the number of nodes in the network) 
are called \emph{miners}. 
%It is important to mention that if a miner sends an invalid block to the network, the protocol states that other nodes should not broadcast it and other miners should not extend a branch from that block. 

\iffalse
% I SEE WHAT YOU DID THERE :)
% This is indeed not always true, but I think it helps in understanding things. I agree that we leave it out in any case.
Assume now that a miner generates a new valid block that points to the last block of the current blockchain. He/she will try to get this new block broadcast across the network as fast as possible, because this makes the branch of such block longer, encouraging other nodes to mine on top of this new block. If he/she keeps this block private, most likely other miners will generate a longer branch without his/her node, and the miner will not be able to place his/her block in the blockchain, missing the associated reward.
\fi

The other important incentive is for including transactions. Why would a miner include the transactions he has received into a new block? The miner might just decide to include few or even none of them. To solve this, the protocol establishes that transactions can include a \emph{fee}. %The sum of the fee of all transactions in a block plus the block reward is the total reward earned by the miner who generated the block, and is known as the mining reward. The miner is naturally encouraged then to choose a subset of the transactions he has received to maximize his reward. 
It is important to note that in most (if not all) existing cryptocurrencies following this protocol, the vast majority of the currency earned by miners comes from the block reward; in current Bitcoin blocks, fees rarely exceed 10\% of the mining reward.\footnote{See  \url{https://www.blockchain.com/charts/miners-revenue} and \url{https://www.blockchain.com/charts/transaction-fees-usd}.}
%\cite{TotalMiningRevenue,TotalMiningFees}. 
%\etienne{check numbers}


\smallskip
\noindent{\bf Contributions.} Mining rewards introduce a competition for generating new blocks, and to ensure that one's own blocks form part of the blockchain. This can be naturally studied from a game-theoretical perspective; miners can be considered as players of a non-cooperative game in which they take some actions to maximize their benefit, and a Nash equilibrium can be considered as a combination of players' strategies where no miner has an incentive to perform a different action. As the blockchain protocol suggest a default behaviour for miner which define a strategy in the game , Nash equilibria contain valuable information about how the protocol's rules encourages/discourages participants to follow/violate the default behaviour. 

We model mining as an infinite stochastic game in which miners are expected to maximize their long-term utility, and through the introduction of several 
basic design parameters we arrive at a model that is general enough to study different cryptocurrencies. In particular, we can study mining under the assumption that block rewards are constant, or when they decrease over time. In the first scenario we show that 
the default scenario of always mining on the latest block of the blockchain is indeed a Nash equilibrium. However, this is not the case for the second scenario, and in fact we 
prove that strategies that involve trying to race the blockchain by forking on a prior block can indeed give higher utility in some cases. Thus we study 
what is the best strategy for miners when assuming everyone else is playing the default strategy. The choice of strategy depends on the hash power, the rate at which 
block rewards decrease over time and the usual financial discount rate. We show that our model confirms the fact that players should start deviating from the default strategy 
when they approach 50\% of the network's hash power. However, in this case the strategy may not be as simple as ``always try to fork'', but rather be a combination 
of appropriately choosing when to fork, and when to give up a race. 


%In this paper we present a framework to represent the miners' incomes in a blockchain protocol and study is realisticness. Then we study the incentives of the miners under two instances of the framework. When we assume that the block creation fee is constant, we prove that the default behaviour is not only a Nash equilibrium, but the one which maximises the income of every miners. Under the assumption that the block creation fee decrease overtime, we computed the utility of a miner for several strategies \etienne{A word on the fact that we have close form for the utility ? Is it useful ? }. We considered a set-up where all the player expect one is playing default, and prove that there exists a thresholds of the hash power ($\leq 0.x$ for Bitcoin \etienne{value when we assume alpha and beta for bitcoin, note that we dont have the actual threshold just an upper bound !}) above which default is not an optimal strategy.

\smallskip
\noindent
{\bf Related Work.} There is a growing body of work studying the network properties of the Bitcoin protocol, as well as technical considerations regarding its security and privacy (see e.g. the survey by Conti et al. \cite{conti2018survey}). One interesting result is that the network's specificity of the protocol could give participants an incentive to deviate from default behaviour, for example by deploying DDOS attacks against other miners \cite{bitcoin_attacks_2013,ddos_attacks2014,empirical_dos_attacks2014}. 

There are a number of studies that approach mining from a game-theoretical point of view. However, as we explain below, all these works 
differ from our project in that they either consider a small subset of strategies, they only study one particular form of reward, constructing a model geared only for this reward, 
or they introduce actions that rely on an outside world (for example, the possibility of cashing bitcoin into, say, US dolars). In contrast, we opt for a clean model that includes every possible mining strategy, allows for modelling block rewards of all cryptocurrencies we are aware of, and focus on cryptocurrencies assuming a closed system. 

More specifically,  Kroll et al. \cite{economics_of_mining2013} focus on a subset of strategies they call \emph{monotonic}, and prove a 
Nash equilibria for these strategies when assuming a constant payoff model. Eyal and Sirer~\cite{selfishmining2014}  and later Sapirshtein et al. in \cite{optimalselfishmining2017} studied a different strategy known as \emph{selfish mining}, in which miners may withhold some of their newly created blocks. Their main result is that, assuming that all other miners are following the default strategy and that block rewards remain constant, a miner with strictly less than 50\% of the network's hash power can increase his income by not always revealing block immediately (thus proving that the default strategy is not a Nash equilibrium). Carlsten et al. \cite{instabilitywithoutreward:2016} studied the \emph{tail} behavior of Bitcoin in which the block reward becomes negligible compared to the mining fees, proving that in such situation miners have further incentives to deviate from the default strategy. 
%Those works differs from our's in that they consider a model with constant block's reward \cite{selfishmining2014,optimalselfishmining2017} or really volatile block's reward \cite{instabilitywithoutreward:2016}. 
A formalisation considering a utility where miners must define a fixed cash-in window as they start the game has been studied in \cite{biais2018blockchain}, and the authors proved the existence of a non-default nash equilibrium in this set-up.
Perhaps the study which is closest in spirit to ours is the one by Kiayias et al. in \cite{mininggames:2016}. %later on extended in \cite{biais2018blockchain}. 
Here the authors also focus on the hash power thresholds for which the optimal default strategy is not an optimal strategy anymore. Albeit the authors consider a range of strategies, their model is not able to consider the same as our.

There are also recent work regarding miners's strategies in multi-cryptocurrency markets. In \cite{dhamal2018stochastic} the authors study the optimal computational power a miner should invest in the market, while in \cite{spiegelman2018game} Spiegelman et al. focus on how to split this computational power over the various available crypto-currencies. Again, we differ in that we focus on a single cryptocurrency in a closed world setting.
