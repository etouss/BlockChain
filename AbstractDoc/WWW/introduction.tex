%!TEX root = main.tex

\section{Introduction}

The Bitcoin Protocol \cite{Bitcoin,DBLP:books/daglib/0040621,NC17}, also known as the Blockchain Protocol or the Nakamoto Protocol, introduces a novel decentralized network-consensus mechanism that is trustless 
and open for anyone connected to the Internet. Moreover, it allows participants to leave and re-join the network at will. To support such an open and dynamic topology the protocol requires an underlying currency (a so-called \emph{cryptocurrency} \cite{NC17}) to encourage/discourage participants to/from taking certain actions. The largest network running this protocol at the time of writing is the Bitcoin network, and its underlying cryptocurrency is Bitcoin (BTC). As of September 2018, Bitcoin is the most successful cryptocurrency with a value per unit of about 6,500 USD\footnote{\url{https://blockchain.info/charts/market-price}.}
%\cite{BitcoinPrice} 
and more than 17 million units in circulation.\footnote{\url{https://blockchain.info/charts/total-bitcoins}.}
%~\cite{Totalcoins}.
 
Following the success of Bitcoin, several new cryptocurrencies have been created. Some of them are simple replicas of Bitcoin with slight modifications on the protocol parameters (e.g. Litecoin~\cite{Litecoin} or Bitcoin Cash~\cite{Bcash}), while some of them introduce interesting new modifications on top of the protocol to provide further functionalities (e.g. Ethereum~\cite{Ethereum,E17} or Monero~\cite{Monero}). Also, there are several tokens that are usually called cryptocurrencies but are either centrally controlled or simple Ponzi schemes without a real cryptocurrency behind.
Considering some of the latter, to this day more than 1,500 cryptocurrencies are being traded.
%~\cite{coinmarketcap}.

However, despite the success and popularity of cryptocurrencies, the foundational aspects of their underlying protocols are far from being fully understood. As it has been claimed before \cite{mininggames:2016}, the Bitcoin protocol involves many actors and incentives, making it rather hard to formalize and study rigorously. A good body of research pursuing this objective has been presented recently~\cite{mininggames:2016,optimalselfishmining2017,instabilitywithoutreward:2016,selfishmining2014,stop_selfish_mining2014,eclipseattacks2015,LBSZR15,LJG15,stubborn_mining:2016,economics_of_mining2013,ZGR17,ABLZ17,MHG18,SZWTK18}, 
yet there are still some fundamental aspects of the protocol that are important and have not been considered. 
In this paper, we present a formal model that takes some of these aspects into consideration. But before presenting our contributions and discussing the related work, we give a brief introduction to the Bitcoin Protocol.

\paragraph{\bf The Bitcoin protocol.} The objective of the Bitcoin protocol is to generate consensus on a data structure that is replicated amongst all nodes in a trustless 
and decentralized peer-to-peer network, in such a way that everyone (not only participants of the network) can verify the integrity of the complete data structure without trusting other nodes. Moreover, the network is open for anyone to participate, and nodes can leave and re-join the network at will. To achieve consensus under these conditions, the Bitcoin protocol requires the shared data structure to be an append-only record of transactions. The inclusion of new transactions to this data structure works as follows: every node that wants to include new transactions must communicate these transactions to their neighbors, who will in turn communicate them with their neighbors, and so on. Transactions are then spread throughout the network via so-called \emph{peer-to-peer whispering}. Naturally, at any point in time every node in the network will have received a set of transactions. Notice that there is no guarantee regarding who received which transaction, so these transactions cannot be considered valid yet. Eventually, one node will be \emph{allowed} (we will explain this in detail later) to form a new \emph{block} and present it as a candidate to extend the data structure. The block will contain some of the transactions received by that node, plus a pointer to some previous block (concretely, the hash value of its header). The newly formed block is then spread throughout the network, also following a whispering protocol. Since every block points to a previous block, a tree of blocks is naturally formed. The consensus data structure is defined as the longest branch of such a tree, which is known as the \emph{blockchain}.

To make the dynamics described above work in a trustless and decentralized network with adversaries, the Bitcoin protocol requires an underlying currency to encourage actors in the network to participate of the protocol. The first and most important incentive is for the generation of new blocks. Whenever a node forms a new block, the node is rewarded with a certain amount of currency. This amount was originally 50BTC and halves  approximately every four years, which is informally known as Bitcoin's \emph{deflation}; the reward is currently 12.5BTC. The currency generated in a block can only be spent whenever the new block contains at least 100 descendants in the tree and forms part of the blockchain. Therefore, whenever a node forms a new block, it is encouraged to place this block in a part of the tree with a high probability of becoming part of the blockchain. Actually, the protocol states that new blocks should always be appended on top of a block with maximal distance to the root of the tree.

Since blocks give reward, nodes will naturally want to generate blocks. If we expect the currency to have any value, generating new blocks must then be hard. A block is called \emph{valid} in the protocol if its hash value (in practice, the hash value of its header), when interpreted as a number, is less than a certain threshold. Since hash functions are pseudo-random, the only way to generate a valid block is to try with several different blocks, until one of them has a hash value below the established threshold. This is known as \emph{mining}, and the number of (valid and invalid) blocks per second that a miner can hash is referred to as his/her \emph{hash power}. Nodes who participate in the generation of blocks (which are in practice very few, compared to the number of nodes in the network) are called \emph{miners}. It is important to mention that if a miner sends an invalid block to the network, the protocol states that other nodes should not broadcast it and other miners should not extend a branch from that block. 

Assume now that a miner generates a new valid block that points to the last block of the current blockchain. He/she will try to get this new block broadcast across the network as fast as possible, because this makes the branch of such a block longer, encouraging other nodes to mine on top of this new block. If he/she keeps this block private, most likely other miners will generate a longer branch without his/her node, and the miner will not be able to place his/her block in the blockchain, missing the associated reward.

The other important incentive is for including transactions. Why would a miner include the transactions he/she has received into a new block? The miner might just decide to include few or even none of them. To solve this, the protocol establishes that transactions can include a \emph{fee}. The fee of all transactions in a block plus the block reward is the total amount of currency earned by the miner who generated the block. To control the practical growth of the blockchain, every block has a maximum size (it is 1MB in the Bitcoin protocol). The miner is naturally encouraged then to choose a subset of the transactions he/she has received to maximize his/her reward. It is important to note that the vast majority of the currency earned by miners comes currently from the block reward; in current Bitcoin blocks, fees rarely exceed 10\% of the block reward.\footnote{See  \url{https://www.blockchain.com/charts/miners-revenue} and \url{https://www.blockchain.com/charts/transaction-fees-usd}.}
%\cite{TotalMiningRevenue,TotalMiningFees}. 


\paragraph*{\bf Contributions.}  From the previous description, it is expected that miners are in practice competing for generating new blocks that will (in the long run) form part of the blockchain. This can be naturally studied from a game-theoretical perspective; miners can be considered as players of a non-cooperative game in which they take some actions to maximize their utility, and a Nash equilibrium can be considered as a combination of players' strategies where no miner has an incentive to perform a different action. In this way, Nash equilibria contain valuable information about how the protocol encourages/discourages participants to/from taking certain actions.
\marcelo{We need to put the list of our contributions here.}
 
\paragraph*{\bf Related Work.} The first game-theoretical formalization of the Bitcoin mining dynamics was presented by Kroll et al. \cite{economics_of_mining2013}, who showed that in the full-disclosure game there is a Nash equilibrium whenever all miners adopt \emph{monotonic} strategies. Eyal and Sirer~\cite{selfishmining2014} introduced a different strategy known as \emph{selfish mining}, in which miners withhold found blocks under certain conditions. Their main result is that a miner with strictly less than 50\% of the network's hash power can \emph{produce} a proportion of the blocks in the blockchain that is higher than his proportion of the network's hash power, assuming that all other miners are following the default strategy (thus proving that the default strategy is not a Nash equilibrium). A good body of work has extended selfish mining. Notably, in \cite{optimalselfishmining2017} the authors present a generalization that is formalized by means of Markov Decision Processes and prove that selfish mining can be further optimized. In \cite{stubborn_mining:2016} selfish mining is analyzed in combination with Eclipse Attacks~\cite{eclipseattacks2015}. Further studies have been carried in efforts to prevent miners from adopting selfish strategies (e.g. \cite{stop_selfish_mining2014,selfishmining2014}). The work around selfish mining differs from our work in that the model they consider assumes all blocks to have the same reward, meaning there is no \emph{deflation} and no discount is considered by miners. Carlsten et al. \cite{instabilitywithoutreward:2016} studied the \emph{tail} behavior of Bitcoin in which the block reward becomes negligible compared to the mining fees. They prove that in such situation miners have further incentives to deviate from the default strategy. The reason is that the probability of losing the reward because of a block not forming part of the blockchain is outweithed by the increase in reward for including high-fee transactions that were already in previous blocks. This work differs from our's in that their model considers as block reward only the transaction fees. Under a model that considers network connectivity, two strategies that are superior to the defalut one are presented in \cite{bitcoin_attacks_2013}. In \cite{ddos_attacks2014,empirical_dos_attacks2014} the authors study the feasibility of earning an \emph{unfair} number of blocks by deploying DDOS attacks against other miners. This is somehow orthogonal since we do not consider practical aspects of the network. 


