\section{Introduction}

The Bitcoin Protocol \cite{Bitcoin} presented in October 2008 by the anonymous Satoshi Nakamoto, also known as the Blockchain Protocol or the Nakamoto Protocol, introduces a novel decentralized network-consensus mechanism that is trustless and is open for anyone connected to the internet. Moreover, it allows participants to leave and re-join the network at will. To support such an open and dynamic topology the protocol requires an underlying currency (a so-called \emph{cryptocurrency}) to incentivize/discourage participants to/from taking certain actions. The largest network running this protocol is the Bitcoin network, and its underlying cryptocurrency is Bitcoin (BTC). As of March 2018, Bitcoin is the most successful cryptocurrency with a value per coin of about 8.100 USD~\cite{BitcoinPrice} and almost 17 million coins in circulation~\cite{Totalcoins}.
 
Following the success of Bitcoin, several new cryptocurrencies have been created. Some of them are simple replicas of Bitcoin with slight modifications on the protocol parameters (e.g. Litecoin~\cite{Litecoin} or Bitcoin Cash~\cite{Bcash}), while some of them introduce interesting new modifications on top of the protocol to provide further functionalities (e.g. Ethereum~\cite{Ethereum} or Monero~\cite{Monero}). Also, there are several tokens that are usually called cryptocurrencies but are either centrally controlled or simple Ponzi schemes without a real cryptocurrency behind. Considering some of the latter, to this day more than 1500 cryptocurrencies have been issued~\cite{coinmarketcap}.

But despite the success and popularity of cryptocurrencies, the foundational aspects of their rulling protocol are far from fully understood. The reality is, the Bitcoin Protocol involves many actors and incentives, making it rather hard to formalize and study rigorously. A good body of research pursuing this objective has been presented recently (see e.g.~\cite{mininggames:2016,optimalselfishmining2017,instabilitywithoutreward:2016}), yet there are still some fundamental aspects of the protocol that are important and have not been considered. In this paper, we present a formal model that takes some of these aspects into consideration. Before presenting our contributions and discussing some related work, we give a brief introduction to the Bitcoin Protocol.

\paragraph{\bf The Bitcoin Protocol.} The objective of the Bitcoin Protocol is to generate consensus on a data structure that is shared among all nodes in a trustless and decentralized peer-to-peer network, in such a way that everyone (not only participants of the network) can verify the integrity of the complete data structure without trusting other nodes. Moreover, the network is open for anyone to participate, and nodes can leave and re-join the network at will. To achieve consensus under these conditions, the Bitcoin Protocol requires the shared data structure to be an append-only record of transactions. The inclussion of new transactions to this data structure works as follows: every node that wants to include new transactions must communicate these transactions to their neighbours, who will in turn communicate them with their neighbours, and so on. Transactions are then spread throughout the network via so-called \emph{peer-to-peer whispering}. Naturally, at any point in time every node in the network will have received a set of transactions. Note that there is no guarantee regarding who received which transaction, so these transactions are not considered valid yet. Eventually, one node will be \emph{allowed} (we will explain this in detail later) to form a new \emph{block} and present it as a candidate to extend the data structure. The block will contain some of the transactions received by that node, plus a pointer to some previous block (concretely, the hash value of its header). The newly formed block is then spread throughout the network, also in a whispering fashion. Since every block points to a previous block, a tree of blocks is naturally formed. The consensus data structure is defined as the longest branch of such tree, which is known as the \emph{blockchain}.

To make the dynamics described above work in a trustless and decentralized network with adversaries, the Bitcoin Protocol requires an underlying currency to incentivize actors in the network. The first and most important incentive is for the generation of new blocks. Whenever a node forms a new block, the node is rewarded with a certain amount of currency. This amount was originally 50BTC and halves every approximately four years; it is currently 12.5BTC. The currency generated in a block can only be spent whenever the new block contains at least 100 descendants in the tree and forms part of the blockchain. Therefore, whenever a node forms a new block, he is incentivized to place this block in a part of the tree with a high probability of becoming part of the blockchain. Actually, the protocol states that new blocks should always be appended on top of a block with maximal distance to the root of the tree.

Since blocks give reward, every node naturally wants to generate blocks. If we expect the currency to have any value, generating new blocks must then be hard. A block is called \emph{valid} by the protocol if its hash value (in practice, the hash value of its header), when interpreted as a number, is less than a certain threshold. Since hash functions are pseudo-random, the only way to generate a valid block is to try with several different blocks, until one of them has a hash value below the established threshold. This is known as \emph{mining}, and the number of (valid and invalid) blocks per second that a miner can hash is called his \emph{hash power}. Nodes who participate in the generation of blocks (which are in practice very few) are called \emph{miners}. It is important to mention that if a miner sends an invalid block to the network, the protocol states that other nodes should not spread it. Therefore it will not become part of the blockchain.

Assume now that a miner generates a new valid block $A$ that points to the last block of the current blockchain. He will try to get this new block spread accross the network as fast as possible, because this makes the branch of such block longer incentivizing other nodes to mine on top of this new block. If he keeps this block private, most likely other miners will generate a longer branch without his node, and he will not be able to place his block in the blockchain, missing the associated rewards.

The other important incentive is for including transactions. Why would a miner include the transactions he has received into a new block? He might just decide to include few of them. To solve this, the protocol establishes that transactions can include a \emph{fee}. The fee of all transactions in a block plus the block reward is the total amount of currency earned by the miner who generated the block. To control the practical growth of the blockchain, every block has a maximum size (in Bitcoin it is 1MB). The miner is naturally incentivized then to choose a subset of the transactions he has received to maximize his reward. It is important to note that the vast majority of the currency earned by miners comes currently from the block reward; in current Bitcoin blocks, fees rarely exceed 10\% of the block reward.

\paragraph*{\bf Related Work.}
From the description above, it is clear that miners are in practice compeeting for generating new blocks that will (in the long run) form part to the blockchain. This can be naturally studied from a game-theoretical perspective to understand the expected behavior of \emph{rational} miners. As mentioned above, the protocol proposes the simple strategy of appending new blocks to the top of an arbitrary branch of maximum length (usually only the blockchain) which is known as the \emph{default strategy}. In their seminal work, Eyal and Sirer~\cite{selfishmining2014} introduced a different strategy known as \emph{selfish mining} under which a miner can \emph{own} a proportion of blocks in the blockchain that is higher than his proportion of the network's hash power, assuming that all other miners are following the default strategy. \cite{optimalselfishmining2017

\paragraph*{\bf Contributions.}



