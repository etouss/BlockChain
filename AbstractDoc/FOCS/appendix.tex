%!TEX root = focs.tex

\section{Proofs and intermediate results}
\label{sec-appendix}


%\begin{mylem}\label{lem-dist-1}
%Given $p \in \bP$, a combined strategy $\bs$ and $\bq_0 \in \bQ$, it holds that:
%\begin{eqnarray*}
%u_p(\bs \mid \bq_0) & = & r_p(\bq_0) +  \beta \cdot 
%\bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = 1}}
%\pr(\bq \mid \bq_0) \cdot u_p(\bs \mid \bq)\bigg).
%\end{eqnarray*}
%\end{mylem}
%
%\begin{proof} We have that:
%\begin{align*}
%u_p(\bs \mid & \ \bq_0)  \ =  \\
%&\sum_{i=0}^{\infty}\beta^{i} \cdot  \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot 
%\pr^{\bs}(\bq \mid \bq_0)\bigg) \ =\\
%& r_p(\bq_0) + \sum_{i=1}^{\infty}\beta^{i} \cdot  \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot 
%\pr^{\bs}(\bq \mid \bq_0)\bigg)\ = \\
%& r_p(\bq_0) + \sum_{i=1}^{\infty}\beta^{i} \cdot  \bigg(
%\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = 1}} \pr^{\bs}(\bq \mid \bq_0) \cdot
%\bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = i-1}} r_p(\bq) \cdot 
%\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\ = \\
%& r_p(\bq_0) + \beta \cdot \sum_{i=1}^{\infty}\beta^{i-1} \cdot  \bigg(
%\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = 1}} \pr^{\bs}(\bq \mid \bq_0) \cdot
%\bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = i-1}} r_p(\bq) \cdot 
%\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\ = \\
%& r_p(\bq_0) + \beta \cdot \sum_{j=0}^{\infty}\beta^{j} \cdot  \bigg(
%\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = 1}} \pr^{\bs}(\bq \mid \bq_0) \cdot
%\bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = j}} r_p(\bq) \cdot 
%\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\ = \\
%& r_p(\bq_0) + 
% \beta \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = 1}} \pr^{\bs}(\bq \mid \bq_0) \cdot \bigg(\sum_{j=0}^{\infty}\beta^{j} \cdot  \bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = j}} r_p(\bq) \cdot 
%\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\bigg)\ = \\
%& r_p(\bq_0) +  \beta \cdot 
%\bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = 1}}
%\pr(\bq \mid \bq_0) \cdot u_p(\bs \mid \bq)\bigg).
%\end{align*}
%\end{proof}


\begin{mylem}\label{lem-dist-k}
Given $p \in \bP$, a combined strategy $\bs$, $\bq_0 \in \bQ$ and $k \geq 1$, it holds that:
\begin{multline*}
u_p(\bs \mid \bq_0) \ = \  
\sum_{i=0}^{k-1} \beta^i \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}}
r_p(\bq) \cdot \pr^{\bs}(\bq \mid \bq_0)\bigg) \ + \\
\beta^k \cdot 
\bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = k}}
\pr^{\bs}(\bq \mid \bq_0) \cdot u_p(\bs \mid \bq)\bigg).
\end{multline*}
\end{mylem}

\begin{proof} We have that:
\begin{align*}
u_p(\bs \mid & \ \bq_0)  \ =  \\
&\sum_{i=0}^{\infty}\beta^{i} \cdot  \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot 
\pr^{\bs}(\bq \mid \bq_0)\bigg) \ =\\
&\sum_{i=0}^{k-1} \beta^i \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}}
r_p(\bq) \cdot \pr^{\bs}(\bq \mid \bq_0)\bigg) + 
\sum_{i=k}^{\infty}\beta^{i} \cdot  \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot 
\pr^{\bs}(\bq \mid \bq_0)\bigg)\ = \\
&  \sum_{i=0}^{k-1} \beta^i \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot \pr^{\bs}(\bq \mid \bq_0)\bigg) \ + \\
& \hspace{15pt} \sum_{i=k}^{\infty}\beta^{i} \cdot  \bigg(
\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = k}} \pr^{\bs}(\bq \mid \bq_0) \cdot
\bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = i-k}} r_p(\bq') \cdot 
\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\ = \\
& \sum_{i=0}^{k-1} \beta^i \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot \pr^{\bs}(\bq \mid \bq_0)\bigg) \ + \\
& \hspace{15pt}
\beta^k \cdot \sum_{i=k}^{\infty}\beta^{i-k} \cdot  \bigg(
\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = k}} \pr^{\bs}(\bq \mid \bq_0) \cdot
\bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = i-k}} r_p(\bq') \cdot 
\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\ = \\
& \sum_{i=0}^{k-1} \beta^i \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot \pr^{\bs}(\bq \mid \bq_0)\bigg) \ + \\
& \hspace{15pt} \beta^k \cdot \sum_{j=0}^{\infty}\beta^{j} \cdot  \bigg(
\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = k}} \pr^{\bs}(\bq \mid \bq_0) \cdot
\bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = j}} r_p(\bq') \cdot 
\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\ = \\
& \sum_{i=0}^{k-1} \beta^i \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot \pr^{\bs}(\bq \mid \bq_0)\bigg) \ + \\
& \hspace{15pt}
 \beta^k \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = k}} \pr^{\bs}(\bq \mid \bq_0) \cdot \bigg(\sum_{j=0}^{\infty}\beta^{j} \cdot  \bigg(\sum_{\substack{\bq' \in \bQ \,: \\ \bq \subseteq \bq' \text{ {\rm and} } |\bq'| - |\bq| = j}} r_p(\bq') \cdot 
\pr^{\bs}(\bq' \mid \bq)\bigg)\bigg)\bigg)\ = \\
& \sum_{i=0}^{k-1} \beta^i \cdot \bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = i}} r_p(\bq) \cdot \pr^{\bs}(\bq \mid \bq_0)\bigg) +  \beta^k \cdot 
\bigg(\sum_{\substack{\bq \in \bQ \,: \\ \bq_0 \subseteq \bq \text{ {\rm and} } |\bq| - |\bq_0| = k}}
\pr^{\bs}(\bq \mid \bq_0) \cdot u_p(\bs \mid \bq)\bigg).
\end{align*}
\end{proof}

\section{Trapezoidal Dyck paths}
\label{appendix-trapezoid}

For nonnegative integers $a,b$, let $\mathcal L_{a,b}$ be the trapezoid in $\ZZ^2$ whose vertices are
$\{(0,0),(a,0),(a+b,b),(0,b)\}.$ Also, let $\mathcal D_{a,b}$ the set of one step north-east paths from $(0,0)$ to $(a+b,b)$ that stay inside $\mathcal L_{a,b}$, and $\sigma_{a,b}=\# \mathcal D_{a,b}$ the amount of possible paths. Finally, let $C_n$ denote the $n$-th Catalan number. 
\begin{myprop*}
The sequence $\sigma:\NN^2\to \NN$ verifies the following
$$\begin{cases}
\sigma_{a,b}=\sum_{i=0}^b\sigma_{a-1,i}C_{b-i}& \mbox{ for }a\geq 1,b\in \NN\\
\sigma_{x,0}=1 & \mbox{ for }x\in \NN\\
\sigma_{0,y}=C_y & \mbox{ for }y\in \NN
\end{cases}$$
\end{myprop*}
\begin{proof}
To prove this, we write $\mathcal D_{a,b}$ as a union of disjoint sets. As a first remark, note that every path in $\mathcal D_{a,b}$ touches the line $l=\overline{(a,0)(a+b,b)}$ at least once. For $i\in \{0,\dots,b\}$, let $P_i$ be the point $(a+i,i)\in l$ and $\mathcal D_{a,b}^{(i)}$ all paths in $\mathcal D_{a,b}$ that touch the line $l$ for the first time at $P_i$. We have the disjoint union
$$\mathcal D_{a,b}=\bigcup_{i=0}^b \mathcal D_{a,b}^{(i)}.$$
Also, note that a path in $\mathcal D_{a,b}$ touches $l$ for the first time in $P_i$ if and only if it passed through the point $P_i-(1,0)$ without exiting $\mathcal D_{a-1,i}$, followed by an east step and any path from $P_i$ to $(a+b,b)$. This yields
\begin{eqnarray*}
\sigma_{a,b}=\sum_{i=0}^{b}\mbox{(paths from $(0,0)$ to $P_i-(0,1))$}\cdot \mbox{(paths from $P_i$ to $(a+b,b))$}
\end{eqnarray*}
Note that the amount of paths from $P_i$ to $(a+b,b)$ is $C_{b-i}$, since both points belong to $l$, proving that $\sigma_{a,b}$ verifies the recurrence equation. The border cases $\sigma_{0,\cdot},\sigma_{\cdot,0}$ are straightforward to prove.
\end{proof}

Now let us define the sequence of generating functions with respect to the second variable of $\sigma_{\cdot,\cdot}$ as follows:
$$\begin{array}{cl}
\phi_a:&\RR\to \RR\\
       &x\mapsto \displaystyle \sum_{j=0}^{\infty}\sigma_{a,j}x^j
\end{array}$$
 
\begin{myprop*}
For $x\in [-1/4,1/4]$ and $a\in \NN$ 
$$\phi_a(x)=c(x)^{a+1},$$
where $c(x):=\frac{1-\sqrt{1-4x}}{2x}$ is the generating function of the Catalan numbers.
\end{myprop*}
\begin{proof}
We have $\sigma_{a,\cdot}=\sigma_{a-1,\cdot}\star C_\cdot$, where $\star$ is the convolution operator, therefore $\phi_a(x)=\phi_{a-1}(x)c(x)$. The result follows noting that $\phi_0(x)=c(x)$.
\end{proof}

\begin{myprop*}
For $(a,b)\in\NN^2$,
$$\sigma_{a,b}=\frac{(a+b)(a+2b)!}{b!(a+b+1)!}=\frac{a+1}{a+b+1}{a+2b\choose a+b}.$$
\end{myprop*}
\begin{proof}
Extract the sequence from the Taylor series of $\phi_a(x)$ around 0 and prove by induction.
\end{proof}

\francisco{@Juan: It would be nice to include your reflection argument as a second (or first!) proof.}




